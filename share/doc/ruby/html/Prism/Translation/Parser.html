<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>class Prism::Translation::Parser - Documentation for Ruby 3.4</title>

  <meta name="keywords" content="ruby,class,Prism::Translation::Parser">

    <meta name="description" content="class Prism::Translation::Parser: It inherits from the base parser for the parser gem, and overrides the parse* methods to parse with prism and then translate.">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<div id="navigation-toggle" role="button" tabindex="0" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="navigation">
  <span aria-hidden="true">&#9776;</span>
</div>


<nav id="navigation" role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search (/) for a class, method, ..." spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
  
  <div id="parent-class-section" class="nav-section">
  <h3>Ancestors</h3>
  <ul><li>Parser::Base</li></ul>
</div>

  
  
  


  <div class="nav-section">
    <h3>Instance Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-i-build_ast">build_ast</a></li>
      <li ><a href="#method-i-build_comments">build_comments</a></li>
      <li ><a href="#method-i-build_offset_cache">build_offset_cache</a></li>
      <li ><a href="#method-i-build_range">build_range</a></li>
      <li ><a href="#method-i-build_tokens">build_tokens</a></li>
      <li ><a href="#method-i-convert_for_prism">convert_for_prism</a></li>
      <li ><a href="#method-i-default_encoding">default_encoding</a></li>
      <li ><a href="#method-i-error_diagnostic">error_diagnostic</a></li>
      <li ><a href="#method-i-parse">parse</a></li>
      <li ><a href="#method-i-parse_with_comments">parse_with_comments</a></li>
      <li ><a href="#method-i-tokenize">tokenize</a></li>
      <li ><a href="#method-i-try_declare_numparam">try_declare_numparam</a></li>
      <li ><a href="#method-i-unwrap">unwrap</a></li>
      <li ><a href="#method-i-valid_error-3F">valid_error?</a></li>
      <li ><a href="#method-i-valid_warning-3F">valid_warning?</a></li>
      <li ><a href="#method-i-warning_diagnostic">warning_diagnostic</a></li>
    </ul>
  </div>



  <footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.10.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

</nav>

<main role="main" aria-labelledby="class-Prism::Translation::Parser">
  <h1 id="class-Prism::Translation::Parser" class="anchor-link class">
    class Prism::Translation::Parser
  </h1>

  <section class="description">
    
<p>This class is the entry-point for converting a prism syntax tree into the whitequark/parser gemâ€™s syntax tree. It inherits from the base parser for the parser gem, and overrides the parse* methods to parse with prism and then translate.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section anchor-link">





     <section id="public-instance-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-default_encoding" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-default_encoding" title="Link to this method">
                <span class="method-name">default_encoding</span>
                <span class="method-args">()</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="default_encoding-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">default_encoding</span>
  <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">UTF_8</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>The default encoding for Ruby files is UTF-8.</p>
        </div>


      </div>

      <div id="method-i-parse" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-parse" title="Link to this method">
                <span class="method-name">parse</span>
                <span class="method-args">(source_buffer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="parse-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parse</span>(<span class="ruby-identifier">source_buffer</span>)
  <span class="ruby-ivar">@source_buffer</span> = <span class="ruby-identifier">source_buffer</span>
  <span class="ruby-identifier">source</span> = <span class="ruby-identifier">source_buffer</span>.<span class="ruby-identifier">source</span>

  <span class="ruby-identifier">offset_cache</span> = <span class="ruby-identifier">build_offset_cache</span>(<span class="ruby-identifier">source</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">unwrap</span>(<span class="ruby-constant">Prism</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">source</span>, <span class="ruby-value">filepath:</span> <span class="ruby-identifier">source_buffer</span>.<span class="ruby-identifier">name</span>, <span class="ruby-value">version:</span> <span class="ruby-identifier">convert_for_prism</span>(<span class="ruby-identifier">version</span>), <span class="ruby-value">partial_script:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">encoding:</span> <span class="ruby-keyword">false</span>), <span class="ruby-identifier">offset_cache</span>)

  <span class="ruby-identifier">build_ast</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">offset_cache</span>)
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@source_buffer</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Parses a source buffer and returns the AST.</p>
        </div>


      </div>

      <div id="method-i-parse_with_comments" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-parse_with_comments" title="Link to this method">
                <span class="method-name">parse_with_comments</span>
                <span class="method-args">(source_buffer)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="parse_with_comments-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parse_with_comments</span>(<span class="ruby-identifier">source_buffer</span>)
  <span class="ruby-ivar">@source_buffer</span> = <span class="ruby-identifier">source_buffer</span>
  <span class="ruby-identifier">source</span> = <span class="ruby-identifier">source_buffer</span>.<span class="ruby-identifier">source</span>

  <span class="ruby-identifier">offset_cache</span> = <span class="ruby-identifier">build_offset_cache</span>(<span class="ruby-identifier">source</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">unwrap</span>(<span class="ruby-constant">Prism</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">source</span>, <span class="ruby-value">filepath:</span> <span class="ruby-identifier">source_buffer</span>.<span class="ruby-identifier">name</span>, <span class="ruby-value">version:</span> <span class="ruby-identifier">convert_for_prism</span>(<span class="ruby-identifier">version</span>), <span class="ruby-value">partial_script:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">encoding:</span> <span class="ruby-keyword">false</span>), <span class="ruby-identifier">offset_cache</span>)

  [
    <span class="ruby-identifier">build_ast</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">offset_cache</span>),
    <span class="ruby-identifier">build_comments</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">comments</span>, <span class="ruby-identifier">offset_cache</span>)
  ]
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@source_buffer</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Parses a source buffer and returns the AST and the source code comments.</p>
        </div>


      </div>

      <div id="method-i-tokenize" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-tokenize" title="Link to this method">
                <span class="method-name">tokenize</span>
                <span class="method-args">(source_buffer, recover = false)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="tokenize-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 79</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tokenize</span>(<span class="ruby-identifier">source_buffer</span>, <span class="ruby-identifier">recover</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-ivar">@source_buffer</span> = <span class="ruby-identifier">source_buffer</span>
  <span class="ruby-identifier">source</span> = <span class="ruby-identifier">source_buffer</span>.<span class="ruby-identifier">source</span>

  <span class="ruby-identifier">offset_cache</span> = <span class="ruby-identifier">build_offset_cache</span>(<span class="ruby-identifier">source</span>)
  <span class="ruby-identifier">result</span> =
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">unwrap</span>(<span class="ruby-constant">Prism</span>.<span class="ruby-identifier">parse_lex</span>(<span class="ruby-identifier">source</span>, <span class="ruby-value">filepath:</span> <span class="ruby-identifier">source_buffer</span>.<span class="ruby-identifier">name</span>, <span class="ruby-value">version:</span> <span class="ruby-identifier">convert_for_prism</span>(<span class="ruby-identifier">version</span>), <span class="ruby-value">partial_script:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">encoding:</span> <span class="ruby-keyword">false</span>), <span class="ruby-identifier">offset_cache</span>)
    <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">SyntaxError</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">recover</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">program</span>, <span class="ruby-identifier">tokens</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">value</span>
  <span class="ruby-identifier">ast</span> = <span class="ruby-identifier">build_ast</span>(<span class="ruby-identifier">program</span>, <span class="ruby-identifier">offset_cache</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">success?</span>

  [
    <span class="ruby-identifier">ast</span>,
    <span class="ruby-identifier">build_comments</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">comments</span>, <span class="ruby-identifier">offset_cache</span>),
    <span class="ruby-identifier">build_tokens</span>(<span class="ruby-identifier">tokens</span>, <span class="ruby-identifier">offset_cache</span>)
  ]
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@source_buffer</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Parses a source buffer and returns the AST, the source code comments, and the tokens emitted by the lexer.</p>
        </div>


      </div>

      <div id="method-i-try_declare_numparam" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-try_declare_numparam" title="Link to this method">
                <span class="method-name">try_declare_numparam</span>
                <span class="method-args">(node)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="try_declare_numparam-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">try_declare_numparam</span>(<span class="ruby-identifier">node</span>)
  <span class="ruby-identifier">node</span>.<span class="ruby-identifier">children</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\A_[1-9]\z/</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Since prism resolves num params for us, we donâ€™t need to support this kind of logic here.</p>
        </div>


      </div>

    </section>

     <section id="private-instance-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

      <div id="method-i-build_ast" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-build_ast" title="Link to this method">
                <span class="method-name">build_ast</span>
                <span class="method-args">(program, offset_cache)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="build_ast-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 263</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build_ast</span>(<span class="ruby-identifier">program</span>, <span class="ruby-identifier">offset_cache</span>)
  <span class="ruby-identifier">program</span>.<span class="ruby-identifier">accept</span>(<span class="ruby-constant">Compiler</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">offset_cache</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Build the parser gem AST from the prism AST.</p>
        </div>


      </div>

      <div id="method-i-build_comments" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-build_comments" title="Link to this method">
                <span class="method-name">build_comments</span>
                <span class="method-args">(comments, offset_cache)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="build_comments-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 268</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build_comments</span>(<span class="ruby-identifier">comments</span>, <span class="ruby-identifier">offset_cache</span>)
  <span class="ruby-identifier">comments</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">comment</span><span class="ruby-operator">|</span>
    <span class="ruby-operator">::</span><span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">Source</span><span class="ruby-operator">::</span><span class="ruby-constant">Comment</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">build_range</span>(<span class="ruby-identifier">comment</span>.<span class="ruby-identifier">location</span>, <span class="ruby-identifier">offset_cache</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Build the parser gem comments from the prism comments.</p>
        </div>


      </div>

      <div id="method-i-build_offset_cache" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-build_offset_cache" title="Link to this method">
                <span class="method-name">build_offset_cache</span>
                <span class="method-args">(source)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="build_offset_cache-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 246</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build_offset_cache</span>(<span class="ruby-identifier">source</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-operator">-&gt;</span> (<span class="ruby-identifier">offset</span>) { <span class="ruby-identifier">offset</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">offset_cache</span> = []
    <span class="ruby-identifier">offset</span> = <span class="ruby-value">0</span>

    <span class="ruby-identifier">source</span>.<span class="ruby-identifier">each_char</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">char</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">char</span>.<span class="ruby-identifier">bytesize</span>.<span class="ruby-identifier">times</span> { <span class="ruby-identifier">offset_cache</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">offset</span> }
      <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">offset_cache</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">offset</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p><a href="../../Prism.html"><code>Prism</code></a> deals with offsets in bytes, while the parser gem deals with offsets in characters. We need to handle this conversion in order to build the parser gem AST.</p>

<p>If the bytesize of the source is the same as the length, then we can just use the offset directly. Otherwise, we build an array where the index is the byte offset and the value is the character offset.</p>
        </div>


      </div>

      <div id="method-i-build_range" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-build_range" title="Link to this method">
                <span class="method-name">build_range</span>
                <span class="method-args">(location, offset_cache)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="build_range-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 280</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build_range</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">offset_cache</span>)
  <span class="ruby-operator">::</span><span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">Source</span><span class="ruby-operator">::</span><span class="ruby-constant">Range</span>.<span class="ruby-identifier">new</span>(
    <span class="ruby-identifier">source_buffer</span>,
    <span class="ruby-identifier">offset_cache</span>[<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_offset</span>],
    <span class="ruby-identifier">offset_cache</span>[<span class="ruby-identifier">location</span>.<span class="ruby-identifier">end_offset</span>]
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Build a range from a prism location.</p>
        </div>


      </div>

      <div id="method-i-build_tokens" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-build_tokens" title="Link to this method">
                <span class="method-name">build_tokens</span>
                <span class="method-args">(tokens, offset_cache)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="build_tokens-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 275</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build_tokens</span>(<span class="ruby-identifier">tokens</span>, <span class="ruby-identifier">offset_cache</span>)
  <span class="ruby-constant">Lexer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">source_buffer</span>, <span class="ruby-identifier">tokens</span>, <span class="ruby-identifier">offset_cache</span>).<span class="ruby-identifier">to_a</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Build the parser gem tokens from the prism tokens.</p>
        </div>


      </div>

      <div id="method-i-convert_for_prism" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-convert_for_prism" title="Link to this method">
                <span class="method-name">convert_for_prism</span>
                <span class="method-args">(version)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="convert_for_prism-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 289</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">convert_for_prism</span>(<span class="ruby-identifier">version</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">version</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">33</span>
    <span class="ruby-string">&quot;3.3.1&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">34</span>
    <span class="ruby-string">&quot;3.4.0&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-string">&quot;latest&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Converts the version format handled by <a href="Parser.html"><code>Parser</code></a> to the format handled by <a href="../../Prism.html"><code>Prism</code></a>.</p>
        </div>


      </div>

      <div id="method-i-error_diagnostic" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-error_diagnostic" title="Link to this method">
                <span class="method-name">error_diagnostic</span>
                <span class="method-args">(error, offset_cache)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="error_diagnostic-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">error_diagnostic</span>(<span class="ruby-identifier">error</span>, <span class="ruby-identifier">offset_cache</span>)
  <span class="ruby-identifier">location</span> = <span class="ruby-identifier">error</span>.<span class="ruby-identifier">location</span>
  <span class="ruby-identifier">diagnostic_location</span> = <span class="ruby-identifier">build_range</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">offset_cache</span>)

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">error</span>.<span class="ruby-identifier">type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:argument_block_multi</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:block_and_blockarg</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:argument_formal_constant</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:argument_const</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:argument_formal_class</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:argument_cvar</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:argument_formal_global</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:argument_gvar</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:argument_formal_ivar</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:argument_ivar</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:argument_no_forwarding_amp</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:no_anonymous_blockarg</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:argument_no_forwarding_star</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:no_anonymous_restarg</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:argument_no_forwarding_star_star</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:no_anonymous_kwrestarg</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:begin_lonely_else</span>
    <span class="ruby-identifier">location</span> = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">copy</span>(<span class="ruby-value">length:</span> <span class="ruby-value">4</span>)
    <span class="ruby-identifier">diagnostic_location</span> = <span class="ruby-identifier">build_range</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">offset_cache</span>)
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:useless_else</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:class_name</span>, <span class="ruby-value">:module_name</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:module_name_const</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:class_in_method</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:class_in_def</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:def_endless_setter</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:endless_setter</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:embdoc_term</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:embedded_document</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:incomplete_variable_class</span>, <span class="ruby-value">:incomplete_variable_class_3_3</span>
    <span class="ruby-identifier">location</span> = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">copy</span>(<span class="ruby-value">length:</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
    <span class="ruby-identifier">diagnostic_location</span> = <span class="ruby-identifier">build_range</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">offset_cache</span>)

    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:cvar_name</span>, { <span class="ruby-value">name:</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">slice</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:incomplete_variable_instance</span>, <span class="ruby-value">:incomplete_variable_instance_3_3</span>
    <span class="ruby-identifier">location</span> = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">copy</span>(<span class="ruby-value">length:</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
    <span class="ruby-identifier">diagnostic_location</span> = <span class="ruby-identifier">build_range</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">offset_cache</span>)

    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:ivar_name</span>, { <span class="ruby-value">name:</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">slice</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:invalid_variable_global</span>, <span class="ruby-value">:invalid_variable_global_3_3</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:gvar_name</span>, { <span class="ruby-value">name:</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">slice</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:module_in_method</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:module_in_def</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:numbered_parameter_ordinary</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:ordinary_param_defined</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:numbered_parameter_outer_scope</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:numparam_used_in_outer_scope</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:parameter_circular</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:circular_argument_reference</span>, { <span class="ruby-value">var_name:</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">slice</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:parameter_name_repeat</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:duplicate_argument</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:parameter_numbered_reserved</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:reserved_for_numparam</span>, { <span class="ruby-value">name:</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">slice</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:regexp_unknown_options</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:regexp_options</span>, { <span class="ruby-value">options:</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">slice</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span>] }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:singleton_for_literals</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:singleton_literal</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:string_literal_eof</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:string_eof</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:unexpected_token_ignore</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:unexpected_token</span>, { <span class="ruby-value">token:</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">slice</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:write_target_in_method</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:error</span>, <span class="ruby-value">:dynamic_const</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">PrismDiagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">error</span>.<span class="ruby-identifier">message</span>, <span class="ruby-value">:error</span>, <span class="ruby-identifier">error</span>.<span class="ruby-identifier">type</span>, <span class="ruby-identifier">diagnostic_location</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Build a diagnostic from the given prism parse error.</p>
        </div>


      </div>

      <div id="method-i-unwrap" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-unwrap" title="Link to this method">
                <span class="method-name">unwrap</span>
                <span class="method-args">(result, offset_cache)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="unwrap-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 224</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unwrap</span>(<span class="ruby-identifier">result</span>, <span class="ruby-identifier">offset_cache</span>)
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">error</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">valid_error?</span>(<span class="ruby-identifier">error</span>)
    <span class="ruby-identifier">diagnostics</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">error_diagnostic</span>(<span class="ruby-identifier">error</span>, <span class="ruby-identifier">offset_cache</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">warnings</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">warning</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">valid_warning?</span>(<span class="ruby-identifier">warning</span>)
    <span class="ruby-identifier">diagnostic</span> = <span class="ruby-identifier">warning_diagnostic</span>(<span class="ruby-identifier">warning</span>, <span class="ruby-identifier">offset_cache</span>)
    <span class="ruby-identifier">diagnostics</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">diagnostic</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">diagnostic</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>If there was a error generated during the parse, then raise an appropriate syntax error. Otherwise return the result.</p>
        </div>


      </div>

      <div id="method-i-valid_error-3F" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-valid_error-3F" title="Link to this method">
                <span class="method-name">valid_error?</span>
                <span class="method-args">(error)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="valid_error-3F-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">valid_error?</span>(<span class="ruby-identifier">error</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>This is a hook to allow consumers to disable some errors if they donâ€™t want them to block creating the syntax tree.</p>
        </div>


      </div>

      <div id="method-i-valid_warning-3F" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-valid_warning-3F" title="Link to this method">
                <span class="method-name">valid_warning?</span>
                <span class="method-args">(warning)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="valid_warning-3F-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">valid_warning?</span>(<span class="ruby-identifier">warning</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>This is a hook to allow consumers to disable some warnings if they donâ€™t want them to block creating the syntax tree.</p>
        </div>


      </div>

      <div id="method-i-warning_diagnostic" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-warning_diagnostic" title="Link to this method">
                <span class="method-name">warning_diagnostic</span>
                <span class="method-args">(warning, offset_cache)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="warning_diagnostic-source">
            <pre><span class="ruby-comment"># File lib/prism/translation/parser.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">warning_diagnostic</span>(<span class="ruby-identifier">warning</span>, <span class="ruby-identifier">offset_cache</span>)
  <span class="ruby-identifier">diagnostic_location</span> = <span class="ruby-identifier">build_range</span>(<span class="ruby-identifier">warning</span>.<span class="ruby-identifier">location</span>, <span class="ruby-identifier">offset_cache</span>)

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">warning</span>.<span class="ruby-identifier">type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:ambiguous_first_argument_plus</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:warning</span>, <span class="ruby-value">:ambiguous_prefix</span>, { <span class="ruby-value">prefix:</span> <span class="ruby-string">&quot;+&quot;</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:ambiguous_first_argument_minus</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:warning</span>, <span class="ruby-value">:ambiguous_prefix</span>, { <span class="ruby-value">prefix:</span> <span class="ruby-string">&quot;-&quot;</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:ambiguous_prefix_ampersand</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:warning</span>, <span class="ruby-value">:ambiguous_prefix</span>, { <span class="ruby-value">prefix:</span> <span class="ruby-string">&quot;&amp;&quot;</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:ambiguous_prefix_star</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:warning</span>, <span class="ruby-value">:ambiguous_prefix</span>, { <span class="ruby-value">prefix:</span> <span class="ruby-string">&quot;*&quot;</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:ambiguous_prefix_star_star</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:warning</span>, <span class="ruby-value">:ambiguous_prefix</span>, { <span class="ruby-value">prefix:</span> <span class="ruby-string">&quot;**&quot;</span> }, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:ambiguous_slash</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:warning</span>, <span class="ruby-value">:ambiguous_regexp</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:dot_dot_dot_eol</span>
    <span class="ruby-constant">Diagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:warning</span>, <span class="ruby-value">:triple_dot_at_eol</span>, {}, <span class="ruby-identifier">diagnostic_location</span>, [])
  <span class="ruby-keyword">when</span> <span class="ruby-value">:duplicated_hash_key</span>
    <span class="ruby-comment"># skip, parser does this on its own</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">PrismDiagnostic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">warning</span>.<span class="ruby-identifier">message</span>, <span class="ruby-value">:warning</span>, <span class="ruby-identifier">warning</span>.<span class="ruby-identifier">type</span>, <span class="ruby-identifier">diagnostic_location</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>Build a diagnostic from the given prism parse warning.</p>
        </div>


      </div>

    </section>

  </section>
</main>

